# üöö DeliveryCalc ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏

DeliveryCalc —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –∑–∞–≤–æ–¥—ã, –º–∞—à–∏–Ω—ã –∏ —Ç–∞—Ä–∏—Ñ—ã, —É—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å–æ–±—ã–µ –ø–æ—Ä–æ–≥–∏ –∏ –≤—ã–¥–∞—ë—Ç —Ç–æ–ø‚Äë3 —Å–∞–º—ã—Ö –≤—ã–≥–æ–¥–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –¥–µ—Å–∫—Ç–æ–ø –∏ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ü–æ–¥–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤ (–º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä—ã, –¥–ª–∏–Ω–Ω–æ–º–µ—Ä—ã, —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞).
- –£—á—ë—Ç special_threshold / max_per_trip –∏ —Å—Ç—É–ø–µ–Ω—á–∞—Ç–æ–π –ª–æ–≥–∏–∫–∏ –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö —Ä–µ–π—Å–æ–≤ (DAF).
- –†–∞–∑–±–∏–≤–∫–∞ —Ä–µ–π—Å–æ–≤ —Å –¥–µ—Ç–∞–ª—è–º–∏: —á—Ç–æ –≤–µ–∑—ë—Ç –∫–∞–∂–¥–∞—è –º–∞—à–∏–Ω–∞, –∫–∞–∫–æ–π —Ç–∞—Ä–∏—Ñ –≤—ã–±—Ä–∞–Ω, –∫–æ–Ω—Ç–∞–∫—Ç –∑–∞–≤–æ–¥–∞.
- –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets (`factories_products` –∏ `tariffs`).
- –ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–µ–∫—Ä–µ—Ç–æ–≤, —á—Ç–æ–±—ã —Ä–∞–±–æ—á–∏–µ –∫–ª—é—á–∏ –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ git.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
backend/                 # FastAPI, —Ä–∞—Å—á—ë—Ç—ã –∏ –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
backend/storage/          # –õ–æ–∫–∞–ª—å–Ω—ã–µ json —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏ –∏ —Ç–æ–≤–∞—Ä–∞–º–∏
frontend/                # React + Vite –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
Dockerfile.backend       # –û–±—Ä–∞–∑ –¥–ª—è FastAPI
Dockerfile.frontend      # –û–±—Ä–∞–∑ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–∞ –Ω–∞ nginx
docker-compose.yml       # –ì–æ—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥: backend + frontend
.env.example             # –®–∞–±–ª–æ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è
google_credentials.example.json # –®–∞–±–ª–æ–Ω —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
```

## üîë –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ)
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` ‚Üí `.env` –∏ –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π `GOOGLE_SHEET_ID` –∏ –ø—É—Ç—å –∫ `google_credentials.json`.
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `google_credentials.example.json` ‚Üí `google_credentials.json` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–º –∫–ª—é—á–æ–º —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (—Ñ–∞–π–ª –≤ git –Ω–µ –∫–æ–º–º–∏—Ç–∏–º).
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install -r backend/requirements.txt
   cd frontend && npm install
   ```

### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ (dev)
1. **Backend** ‚Äî FastAPI —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –∏ –¥–æ—Å—Ç—É–ø–æ–º –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞:
   ```bash
   uvicorn backend.app.main:app --reload --host 0.0.0.0 --port 8000
   ```
   - OSRM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä), –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `/api/quote`.
   - JSON-—Ñ–∞–π–ª—ã `backend/storage` –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏; –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `/admin/reload`.

2. **Frontend** ‚Äî Vite dev-server c –ø—Ä–æ–±—Ä–æ—Å–æ–º API –Ω–∞ localhost:
   ```bash
   cd frontend
   npm run dev -- --host --port 5173
   ```
   - –í dev API –±–∞–∑–∞ –∑–∞–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`http://127.0.0.1:8000`). –ï—Å–ª–∏ –º–µ–Ω—è–µ—Ç–µ –ø–æ—Ä—Ç –∏–ª–∏ —Ö–æ—Å—Ç –±—ç–∫–µ–Ω–¥–∞, –∑–∞–¥–∞–π—Ç–µ `VITE_API_BASE` –≤ `.env` —Ñ—Ä–æ–Ω—Ç–∞.

## üê≥ Docker/Compose
–¢—Ä–µ–±—É—é—Ç—Å—è `.env` –∏ `google_credentials.json` —Ä—è–¥–æ–º —Å `docker-compose.yml`. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ (–ª–æ–∫–∞–ª—å–Ω–æ):
```bash
docker compose up --build
```
- **Backend**: http://localhost:8000 (–∞–≤—Ç–æ-–¥–æ–±–∞–≤–ª—è–µ—Ç CORS –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞ –∏–∑ compose).
- **Frontend**: http://localhost:5173 ‚Äî —Å—Ç–∞—Ç–∏–∫–∞ –Ω–∞ nginx, `/api` –∏ `/admin` –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ backend.
- **–ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–∞ —Å –¥—Ä—É–≥–∏–º API**: –≤–æ –≤—Ä–µ–º—è `docker compose build` –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å `VITE_API_BASE=http://<host>:8000`.

### üöÄ –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ VDS/Timeweb —á–µ—Ä–µ–∑ Docker Compose
1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ `.env` –∏–∑ —à–∞–±–ª–æ–Ω–∞ –∏ –ø–æ–ª–æ–∂–∏—Ç–µ —Ä—è–¥–æ–º —Å `docker-compose.timeweb.yml`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `GOOGLE_APPLICATION_CREDENTIALS` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—É—Ç—å `/app/secrets/google_credentials.json` (–æ–Ω –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).
2. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª `google_credentials.json` —Ä—è–¥–æ–º —Å compose-—Ñ–∞–π–ª–æ–º (–Ω–µ –∫–æ–º–º–∏—Ç–∏–º –≤ git).
3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–Ω—è—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π OSRM, —Å–∫–∞—á–∞–π—Ç–µ `.osrm` –≤ –ø–∞–ø–∫—É `osrm-data` –∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º `with-osrm`.
4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Ñ–æ–Ω–µ:
   ```bash
   docker compose -f docker-compose.timeweb.yml up -d --build
   ```
   - Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `:8000`, frontend ‚Äî –Ω–∞ –ø–æ—Ä—Ç—É `80` (nginx).
   - VITE_API_BASE –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ `.env` –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π, —á—Ç–æ–±—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ä–∞–∑—É —É–∫–∞–∑—ã–≤–∞–ª –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ–º–µ–Ω.
5. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Ñ—Ä–æ–Ω—Ç/–±—ç–∫–µ–Ω–¥ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: `docker compose -f docker-compose.timeweb.yml up -d --build`.
6. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `docker compose -f docker-compose.timeweb.yml down`.

## üì° –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `GET /api/factories` ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –∑–∞–≤–æ–¥–∞—Ö
- `GET /api/tariffs` ‚Äî —Ç–∞—Ä–∏—Ñ—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- `POST /api/quote` ‚Äî —Ä–∞—Å—á—ë—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã, —Ä–µ–π—Å—ã, —Ç–∞—Ä–∏—Ñ—ã)
- `POST /admin/reload` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ `/api/quote`
```json
{
  "upload_lat": 55.7558,
  "upload_lon": 37.6173,
  "transport_type": "auto",
  "addManipulator": true,
  "selectedSpecial": "–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä SPECIAL",
  "items": [
    { "category": "–î–æ—Ä–æ–∂–Ω—ã–µ –ü–õ–ò–¢–´/–ü–ê–ì–ò", "subtype": "2–ø30.18.30 –¢–£", "quantity": 10 }
  ]
}
```
### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (—Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ)
```json
{
  "variants": [
    {
      "totalCost": 167000,
      "deliveryCost": 48000,
      "totalWeight": 44,
      "tripItems": [
        {
          "–∑–∞–≤–æ–¥": "—Ç—É–±–µ—Ç–æ–Ω",
          "–º–∞—à–∏–Ω–∞": "–î–ª–∏–Ω–Ω–æ–º–µ—Ä MAN TSG",
          "—Ç–∞—Ä–∏—Ñ": "80-100 –∫–º / –¥–ª–∏–Ω–æ–º–µ—Ä / >20—Ç",
          "—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ_–∫–º": 79.29,
          "–∑–∞–≥—Ä—É–∑–∫–∞_—Ç": 40,
          "—Ç–æ–≤–∞—Ä—ã": "2–ø30.18.30 –¢–£ √ó 18",
          "—Å—Ç–æ–∏–º–æ—Å—Ç—å_–¥–æ—Å—Ç–∞–≤–∫–∏": 48000
        }
      ]
    }
  ]
}
```

## üßπ –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏
- `.env`, `google_credentials.json`, `delivery_bot_2_credentials.json` —É–∂–µ –≤ `.gitignore` –∏ `.dockerignore`.
- –ï—Å–ª–∏ –∫–ª—é—á —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ø–∞–ª –≤ git ‚Äî —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏, –≤—ã–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–π –≤ Google Cloud –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –∏–∑ —à–∞–±–ª–æ–Ω–∞.
## üí° –°–æ–≤–µ—Ç—ã –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `VITE_API_BASE` –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Ñ—Ä–æ–Ω—Ç–∞, –µ—Å–ª–∏ backend —Ä–∞–∑–º–µ—â—ë–Ω –Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ.
- –í `docker-compose.yml` –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `backend/storage` –≤—ã–Ω–µ—Å–µ–Ω–æ –≤ volume: –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å json –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞.
- UI –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π: —Ç–∞–±–ª–∏—Ü—ã –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–º–µ—é—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É, –∫–Ω–æ–ø–∫–∏ –∏ –ø–æ–ª—è —É–≤–µ–ª–∏—á–µ–Ω—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ.
